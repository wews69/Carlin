<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Will You Be My Valentine? ðŸ’Œ</title>
  <style>
    :root {
      --pink: #ff4081;
      --light-pink: #ff80ab;
      --deep-pink: #e91e63;
      --bg-start: #fff0f5;
      --bg-end: #ffe4e9;
    }

    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      min-height: 100dvh;
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
      color: #333;
      overflow-x: hidden;
      display: grid;
      place-items: center;
      touch-action: manipulation;
      position: relative;
    }

    .floating-hearts { position: fixed; inset: 0; pointer-events: none; z-index: -1; overflow: hidden; }
    .heart-bg {
      position: absolute;
      font-size: 1.8rem;
      opacity: 0.35;
      animation: float 18s linear infinite;
      user-select: none;
    }
    @keyframes float { 0% { transform: translateY(110vh) rotate(0deg); } 100% { transform: translateY(-15vh) rotate(360deg); } }

    .screen, #startScreen {
      position: fixed;
      inset: 0;
      padding: 2rem 1.5rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      transition: opacity 0.7s ease;
      opacity: 0;
      pointer-events: none;
    }

    .screen.active, #startScreen.active { opacity: 1; pointer-events: auto; }

    #startScreen {
      background: linear-gradient(135deg, rgba(255,105,180,0.92), rgba(240,98,146,0.88));
      color: white;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    h1 { font-size: clamp(2.6rem, 11vw, 4.8rem); color: white; line-height: 1.05; margin: 0.3em 0 0.1em; text-shadow: 0 4px 12px rgba(0,0,0,0.35); }
    #startScreen p { font-size: clamp(1.3rem, 5.5vw, 1.8rem); margin: 1.8rem 0 2.2rem; opacity: 0.95; }

    button {
      padding: 0.9rem 2.4rem;
      font-size: clamp(1.1rem, 5vw, 1.5rem);
      font-weight: bold;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      margin: 0.9rem 1rem;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
      min-width: 140px;
    }

    .start-btn, .yes {
      background: linear-gradient(145deg, var(--pink), var(--deep-pink));
      color: white;
    }

    .start-btn:hover, .yes:hover { transform: translateY(-4px) scale(1.05); box-shadow: 0 12px 30px rgba(233,30,99,0.5); }
    .start-btn:active, .yes:active { transform: scale(0.96); }

    .no {
      background: #e0e0e0;
      color: #555;
      cursor: default;
      box-shadow: none;
      position: absolute;
      min-width: 120px;
    }

    #miniGameArea {
      width: min(90vw, 400px);
      height: 400px;
      position: relative;
      background: rgba(255, 182, 193, 0.28);
      border-radius: 24px;
      overflow: hidden;
      margin: 1.8rem auto;
      border: 3px dashed var(--pink);
      box-shadow: 0 8px 30px rgba(255,105,180,0.25);
    }

    .falling-heart {
      position: absolute;
      width: 64px;
      height: 64px;
      user-select: none;
      cursor: pointer;
      animation: fall linear forwards;
      will-change: transform;
    }

    .falling-heart img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      pointer-events: none;
    }

    @keyframes fall { to { transform: translateY(480px); } }

    #gameMessage {
      font-size: clamp(1.6rem, 6.5vw, 2.4rem);
      color: var(--pink);
      margin: 1.2rem 0;
      font-weight: 700;
      min-height: 3em;
      text-align: center;
    }

    #mailDrop {
      position: absolute;
      top: -320px;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      max-width: 80vw;
      opacity: 0;
      transition: all 2.5s cubic-bezier(0.68, -0.55, 0.265, 1.6);
      z-index: 20;
      cursor: pointer;
      filter: drop-shadow(0 12px 30px rgba(0,0,0,0.4));
    }

    #mailDrop.visible { top: 10%; opacity: 1; }

    #letterContainer {
      display: none;
      width: min(92vw, 380px);
      background: rgb(255, 228, 235);
      border: 3px solid var(--light-pink);
      border-radius: 20px;
      padding: 2.2rem;
      margin: 2.2rem auto;
      font-size: clamp(1.15rem, 4.8vw, 1.4rem);
      line-height: 1.65;
      text-align: center;
      box-shadow: 0 10px 35px rgba(0,0,0,0.18);
      overflow-y: auto;
      max-height: 42vh;
      -webkit-overflow-scrolling: touch;
    }

    .continue-btn {
      margin-top: 2.2rem;
      padding: 1.1rem 2.8rem;
      font-size: clamp(1.2rem, 5.5vw, 1.7rem);
      background: white;
      color: var(--pink);
      border: 3px solid var(--pink);
      border-radius: 999px;
      cursor: pointer;
      opacity: 0;
      transform: translateY(50px);
      transition: all 0.8s ease;
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }

    .continue-btn.visible { opacity: 1; transform: translateY(0); }

    #yesScreen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #ff4081, #f06292);
      color: white;
      font-weight: bold;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 999;
      padding: 2rem;
    }

    #yesScreen .emoji-big { font-size: clamp(9rem, 38vw, 18rem); margin: 0.5em 0; }

    #audioNote {
      position: fixed;
      bottom: 10px;
      left: 0;
      right: 0;
      text-align: center;
      color: #666;
      font-size: 0.9rem;
      display: none;
      z-index: 100;
    }
  </style>
</head>
<body>

<div class="floating-hearts" id="bgHearts"></div>

<div id="startScreen" class="active">
  <h1>Hey love â™¡</h1>
  <p>Tap start for a little surprise...</p>
  <button id="startButton" class="start-btn">Start â†’</button>
</div>

<div id="s2" class="screen">
  <h2></h2>
  <div id="miniGameArea"></div>
  <div id="gameMessage">Tap the falling hearts!</div>

  <img id="mailDrop" src="https://media.tenor.com/JefDUKN1lvkAAAAm/love-letter-romantic.webp" alt="Cute pink envelope">

  <div id="letterContainer">
    <p>Happy Valentine's Day, my love.</p>
    <p>Today is a reminder of how lucky I am to have you in my life, but honestly, every day with you already feels special. You came into my life in a way I didn't expect, yet you became someone I never want to lose. Your presence alone brings me comfort, and your love gives me strength in ways you might not even realize.</p>
    <p>Thank you for being my safe placeâ€”the person I can laugh with, open up to, and be myself around. You see me at my best and at my weakest, and still, you choose to stay. That means more to me than I could ever explain. Your patience, your understanding, and your kindness make my world brighter, even on days when everything feels heavy.</p>
    <p>I appreciate all the little things you do, the messages, the time, the effort, the care. Those small moments are what make my love for you grow deeper every day. Being with you has taught me what it means to love genuinely and to be loved in return.</p>
    <p>No matter what the future holds, I'm grateful for what we have right now. I promise to keep choosing you, to support you, and to love you in the best way I can. Thank you for being you, for loving me, and for sharing your heart with mine.</p>
    <p>Happy Valentine's Day, my lovey iloveyousomuch</p>
  </div>

  <button class="continue-btn" id="continueBtn">Press to continue</button>
</div>

<div id="s1" class="screen">
  <img src="https://media.tenor.com/EqEGS0cSfNUAAAAM/mwah-cat-rose.gif" alt="Heart" class="heart-img">
  <h1>Heyy...</h1>
  <h2>Will you open my message?</h2>
  <button id="yesEnvelopeBtn" class="yes">Yes! ðŸ’Œ</button>
</div>

<div id="s3" class="screen">
  <img src="https://media.tenor.com/EqEGS0cSfNUAAAAM/mwah-cat-rose.gif" alt="Heart" class="heart-img">
  <h1>Will you be my Valentine?</h1>
  <div id="buttonContainer" style="position: relative; width: 100%; max-width: 800px; min-height: 400px; margin: 3rem 0;">
    <button id="yesValentineBtn" class="yes">YES</button>
    <button class="no" id="noBtn">No</button>
  </div>
</div>

<div id="yesScreen">
  <div class="emoji-big"></div>
  <div style="font-size: clamp(2.4rem, 10vw, 5rem); margin: 0.4em 0;">YAYYYY</div>
  <div style="font-size: clamp(1.7rem, 6.5vw, 2.8rem);">Pede pa kiss</div>
</div>

<audio id="bgMusic" preload="auto" loop playsinline muted>
  <source src="https://image2url.com/r2/default/audio/1770244270065-d05a8a22-e24e-4d05-9aca-95ea6057ad46.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>

<div id="audioNote">Tap Start or anywhere to play music â™¡ (mobile may require tap to allow sound)</div>

<script>
const music = document.getElementById('bgMusic');
const audioNote = document.getElementById('audioNote');
const startButton = document.getElementById('startButton');
const yesEnvelopeBtn = document.getElementById('yesEnvelopeBtn');
const continueBtn = document.getElementById('continueBtn');
const yesValentineBtn = document.getElementById('yesValentineBtn');
const noBtn = document.getElementById('noBtn');
const gameArea = document.getElementById('miniGameArea');
const gameMessage = document.getElementById('gameMessage');
const mailDrop = document.getElementById('mailDrop');
const letterContainer = document.getElementById('letterContainer');

let heartsCollected = 0;
const neededHearts = 15; // CHANGED TO 15 HEARTS
let isPostGame = false;

const heartImageSrc = "https://media.tenor.com/0-M-_QQY4eQAAAAm/pixel-heart.webp";

// 9 safe spots (relative % of container) â€” far from center/Yes button
const safeSpots = [
  { left: 5,  top: 10 },   // top-left
  { left: 5,  top: 50 },   // mid-left
  { left: 5,  top: 85 },   // bottom-left
  { left: 95, top: 10 },   // top-right (right edge)
  { left: 95, top: 50 },   // mid-right
  { left: 95, top: 85 },   // bottom-right
  { left: 50, top: 5  },   // top-center but high
  { left: 50, top: 95 },   // bottom-center but low
  { left: 20, top: 90 }    // bottom-leftish extra
];

let lastSpotIndex = -1;

function getRandomSafeSpot() {
  let index;
  do {
    index = Math.floor(Math.random() * safeSpots.length);
  } while (index === lastSpotIndex && safeSpots.length > 1);
  lastSpotIndex = index;
  return safeSpots[index];
}

async function tryPlayMusic() {
  try {
    music.muted = false;
    await music.play();
    audioNote.style.display = 'none';
  } catch (e) {
    console.log("Play failed:", e);
    audioNote.style.display = 'block';
  }
}

['click', 'touchstart', 'pointerdown'].forEach(evt => {
  document.addEventListener(evt, tryPlayMusic, { once: false, passive: true });
});

music.addEventListener('canplay', tryPlayMusic);

// Background hearts
function createBgHearts() {
  const container = document.getElementById('bgHearts');
  for (let i = 0; i < 18; i++) {
    const heart = document.createElement('div');
    heart.className = 'heart-bg';
    heart.textContent = ['ðŸ’—','ðŸ’ž','ðŸ’“','ðŸ’•','â¤ï¸'][Math.floor(Math.random()*5)];
    heart.style.left = Math.random() * 100 + '%';
    heart.style.animationDelay = Math.random() * 12 + 's';
    heart.style.animationDuration = (12 + Math.random() * 14) + 's';
    heart.style.fontSize = (1.2 + Math.random() * 2.2) + 'rem';
    container.appendChild(heart);
  }
}
createBgHearts();

startButton.addEventListener('click', startGame);
yesEnvelopeBtn.addEventListener('click', () => {
  document.getElementById('s1').classList.remove('active');
  startMiniGame();
});
continueBtn.addEventListener('click', goToProposal);
yesValentineBtn.addEventListener('click', sayYes);

mailDrop.addEventListener('click', () => {
  if (heartsCollected >= neededHearts && !isPostGame) {
    isPostGame = true;
    gameArea.style.display = 'none';
    gameMessage.textContent = "";
    letterContainer.style.display = 'block';
    mailDrop.style.top = '6%';
    mailDrop.style.width = '200px';
    mailDrop.style.cursor = 'default';
  }
});

letterContainer.addEventListener('scroll', () => {
  if (letterContainer.scrollTop + letterContainer.clientHeight >= letterContainer.scrollHeight - 80) {
    continueBtn.classList.add('visible');
  }
});

function startGame() {
  document.getElementById('startScreen').classList.remove('active');
  document.getElementById('s2').classList.add('active');
  tryPlayMusic();
  startMiniGame();
}

function startMiniGame() {
  heartsCollected = 0;
  isPostGame = false;
  gameMessage.textContent = `Collect ${neededHearts} hearts! (0/${neededHearts})`;
  continueBtn.classList.remove('visible');
  mailDrop.classList.remove('visible');
  letterContainer.style.display = 'none';
  gameArea.style.display = 'block';
  startFallingHearts();
}

function startFallingHearts() {
  const interval = setInterval(() => {
    if (heartsCollected >= neededHearts) {
      clearInterval(interval);
      gameMessage.textContent = "You won a mail! Tap it!";
      mailDrop.classList.add('visible');
      return;
    }

    const heart = document.createElement('div');
    heart.className = 'falling-heart';
    heart.style.left = Math.random() * 88 + '%';
    heart.style.animationDuration = (Math.random() * 3.5 + 4.5) + 's';

    const img = new Image();
    img.src = heartImageSrc;
    img.alt = "pixel heart";
    img.draggable = false;

    img.onload = () => heart.appendChild(img);
    img.onerror = () => { heart.textContent = 'â¤ï¸'; };

    heart.appendChild(img);
    gameArea.appendChild(heart);

    heart.addEventListener('click', () => {
      heartsCollected++;
      gameMessage.textContent = `Collect ${neededHearts} hearts! (${heartsCollected}/${neededHearts})`;
      heart.remove();

      if (heartsCollected >= neededHearts) {
        gameMessage.textContent = "You won a mail! Tap it! â™¡";
        mailDrop.classList.add('visible');
        clearInterval(interval);
      }
    });

    setTimeout(() => heart.remove(), 9500);
  }, 950);
}

function goToProposal() {
  document.getElementById('s2').classList.remove('active');
  document.getElementById('s3').classList.add('active');
  setTimeout(moveNoButton, 300);
}

function sayYes() {
  document.getElementById('yesScreen').style.display = 'flex';
}

// Teleport to one of 9 safe spots
function moveNoButton(e) {
  if (e) e.preventDefault();

  const container = document.getElementById('buttonContainer');
  if (!container) return;

  const rect = container.getBoundingClientRect();

  const spot = getRandomSafeSpot();

  // Convert % to pixels
  const x = (spot.left / 100) * rect.width - 60; // offset half button width approx
  const y = (spot.top  / 100) * rect.height - 35;

  noBtn.style.transition = 'none';
  noBtn.style.left = `${x}px`;
  noBtn.style.top  = `${y}px`;
}

noBtn.addEventListener('touchstart', moveNoButton);
noBtn.addEventListener('mouseover', moveNoButton);
noBtn.addEventListener('click', moveNoButton);
noBtn.addEventListener('pointerdown', moveNoButton);
</script>
</body>
</html>